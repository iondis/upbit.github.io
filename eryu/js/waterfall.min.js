/*! waterfall - v0.1.72 - 2014-06-24
* http://wlog.cn/waterfall/
* Copyright (c) 2014 bingdian; Licensed MIT */
;(function(d,b,a,h){var g=d(b),c="waterfall",e={itemCls:"waterfall-item",prefix:"waterfall",fitWidth:true,colWidth:240,gutterWidth:10,gutterHeight:10,align:"center",minCol:1,maxCol:h,maxPage:h,bufferPixel:-50,containerStyle:{position:"relative"},resizable:true,isFadeIn:false,isAnimated:false,animationOptions:{},isAutoPrefill:true,checkImagesLoaded:true,path:h,dataType:"jsonp",params:{},headers:{},loadingMsg:'<div style="text-align:center;padding:10px 0; color:#999;"><img src="data:image/gif;base64,R0lGODlhEAALAPQAAP///zMzM+Li4tra2u7u7jk5OTMzM1hYWJubm4CAgMjIyE9PT29vb6KiooODg8vLy1JSUjc3N3Jycuvr6+Dg4Pb29mBgYOPj4/X19cXFxbOzs9XV1fHx8TMzMzMzMzMzMyH5BAkLAAAAIf4aQ3JlYXRlZCB3aXRoIGFqYXhsb2FkLmluZm8AIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQJCwAAACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQJCwAAACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQJCwAAACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAkLAAAALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkECQsAAAAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAkLAAAALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkECQsAAAAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7" alt=""><br />Loading...</div>',state:{isDuringAjax:false,isProcessingData:false,isResizing:false,isPause:false,curPage:1},callbacks:{loadingStart:function(i){i.show()},loadingFinished:function(j,i){if(!i){j.fadeOut()}else{j.remove()}},loadingError:function(i,j){i.html("Data load faild, please try again later.")},renderData:function(l,i){var j,k;if(i==="json"||i==="jsonp"){j=d("#waterfall-tpl").html();k=Handlebars.compile(j);return k(l)}else{return l}}},debug:false};function f(j,i){this.$element=d(j);this.options=d.extend(true,{},e,i);this.colHeightArray=[];this.styleQueue=[];this._init()}f.prototype={constructor:f,_debug:function(){if(true!==this.options.debug){return}if(typeof console!=="undefined"&&typeof console.log==="function"){if((Array.prototype.slice.call(arguments)).length===1&&typeof Array.prototype.slice.call(arguments)[0]==="string"){console.log((Array.prototype.slice.call(arguments)).toString())}else{console.log(Array.prototype.slice.call(arguments))}}else{if(!Function.prototype.bind&&typeof console!=="undefined"&&typeof console.log==="object"){Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments))}}},_init:function(k){var i=this.options,j=i.path;this._setColumns();this._initContainer();this._resetColumnsHeightArray();this.reLayout(k);if(!j){this._debug("Invalid path");return}if(i.isAutoPrefill){this._prefill()}if(i.resizable){this._doResize()}this._doScroll()},_initContainer:function(){var i=this.options,j=i.prefix;d("body").css({overflow:"scroll"});this.$element.css(this.options.containerStyle).addClass(j+"-container");this.$element.after('<div id="'+j+'-loading">'+i.loadingMsg+'</div><div id="'+j+'-message" style="text-align:center;color:#999;"></div>');this.$loading=d("#"+j+"-loading");this.$message=d("#"+j+"-message")},_getColumns:function(){var q=this.options,o=q.fitWidth?this.$element.parent():this.$element,m=o[0].tagName==="BODY"?o.width()-20:o.width(),k=q.colWidth,i=q.gutterWidth,n=q.minCol,p=q.maxCol,l=Math.floor(m/(k+i)),j=Math.max(l,n);return !p?j:(j>p?p:j)},_setColumns:function(){this.cols=this._getColumns()},_getItems:function(i){var j=i.filter("."+this.options.itemCls).css({position:"absolute"});return j},_resetColumnsHeightArray:function(){var k=this.cols,j;this.colHeightArray.length=k;for(j=0;j<k;j++){this.colHeightArray[j]=0}},layout:function(l,y){var z=this.options,w=this.options.isFadeIn?this._getItems(l).css({opacity:0}).animate({opacity:1}):this._getItems(l),o=(this.options.isAnimated&&this.options.state.isResizing)?"animate":"css",p=z.animationOptions,t=z.colWidth,k=z.gutterWidth,u=this.colHeightArray.length,v=z.align,x,s,r,q,n,m;this.$element.append(w);if(v==="center"){x=(this.$element.width()-t*u-k*(u-1))/2;x=x>0?x:0}else{if(v==="left"){x=0}else{if(v==="right"){x=this.$element.width()-t*u-k*(u-1)}}}for(r=0,n=w.length;r<n;r++){this._placeItems(w[r],x)}for(q=0,m=this.styleQueue.length;q<m;q++){s=this.styleQueue[q];s.$el[o](s.style,p)}this.$element.height(Math.max.apply({},this.colHeightArray));this.styleQueue=[];this.options.state.isResizing=false;this.options.state.isProcessingData=false;if(y){y.call(w)}},reLayout:function(j){var i=this.$element.find("."+this.options.itemCls);this._resetColumnsHeightArray();this.layout(i,j)},_placeItems:function(t,r){var p=d(t),u=this.options,l=u.colWidth,i=u.gutterWidth,k=u.gutterHeight,j=this.colHeightArray,n=j.length,o=Math.min.apply({},j),s=d.inArray(o,j),q,m;if(p.hasClass(u.prefix+"-item-fixed-left")){q=0}else{if(p.hasClass(u.prefix+"-item-fixed-right")){q=(n>1)?(n-1):0}else{q=s}}m={left:(l+i)*q+r,top:j[q]};this.styleQueue.push({$el:p,style:m});j[q]+=p.outerHeight()+k},prepend:function(i,j){this.$element.prepend(i);this.reLayout(j)},append:function(i,j){this.$element.append(i);this.reLayout(j)},removeItems:function(j,i){this.$element.find(j).remove();this.reLayout(i)},option:function(i,j){if(d.isPlainObject(i)){this.options=d.extend(true,this.options,i);if(typeof j==="function"){j()}this._init()}},pause:function(i){this.options.state.isPause=true;if(typeof i==="function"){i()}},resume:function(i){this.options.state.isPause=false;if(typeof i==="function"){i()}},_requestData:function(o){var p=this,r=this.options,l=r.maxPage,m=r.state.curPage++,q=r.path,n=r.dataType,k=r.params,i=r.headers,j;if(l!==h&&m>l){r.state.isBeyondMaxPage=true;r.callbacks.loadingFinished(this.$loading,r.state.isBeyondMaxPage);return}j=(typeof q==="function")?q(m):q.join(m);this._debug("heading into ajax",j+d.param(k));r.callbacks.loadingStart(this.$loading);r.state.isDuringAjax=true;r.state.isProcessingData=true;d.ajax({url:j,data:k,headers:i,dataType:n,success:function(s){p._handleResponse(s,o);p.options.state.isDuringAjax=false},error:function(s){p._responeseError("error")}})},_handleResponse:function(m,o){var i=this,k=this.options,l=d.trim(k.callbacks.renderData(m,k.dataType)),j=d(l),n=k.checkImagesLoaded;if(!n){i.append(j,o);i.options.callbacks.loadingFinished(i.$loading,i.options.state.isBeyondMaxPage)}else{j.imagesLoaded(function(){i.append(j,o);i.options.callbacks.loadingFinished(i.$loading,i.options.state.isBeyondMaxPage)})}},_responeseError:function(i){this.$loading.hide();this.options.callbacks.loadingError(this.$message,i);if(i!=="end"&&i!=="error"){i="unknown"}this._debug("Error",i)},_nearbottom:function(){var k=this.options,j=Math.min.apply({},this.colHeightArray),i=g.scrollTop()+g.height()-this.$element.offset().top-j;this._debug("math:",i);return(i>k.bufferPixel)},_prefill:function(){if(this.$element.height()<=g.height()){this._scroll()}},_scroll:function(){var j=this.options,k=j.state,i=this;if(k.isProcessingData||k.isDuringAjax||k.isInvalidPage||k.isPause){return}if(!this._nearbottom()){return}this._requestData(function(){var l=setTimeout(function(){i._scroll()},100)})},_doScroll:function(){var i=this,j;g.bind("scroll",function(){if(j){clearTimeout(j)}j=setTimeout(function(){i._scroll()},100)})},_resize:function(){var j=this.cols,i=this._getColumns();if(i!==j||this.options.align!=="left"){this.options.state.isResizing=true;this.cols=i;this.reLayout();this._prefill()}},_doResize:function(){var j=this,i;g.bind("resize",function(){if(i){clearTimeout(i)}i=setTimeout(function(){j._resize()},100)})}};d.fn[c]=function(j){if(typeof j==="string"){var i=Array.prototype.slice.call(arguments,1);this.each(function(){var k=d.data(this,"plugin_"+c);if(!k){k._debug("instance is not initialization");return}if(!d.isFunction(k[j])||j.charAt(0)==="_"){k._debug('no such method "'+j+'"');return}k[j].apply(k,i)})}else{this.each(function(){if(!d.data(this,"plugin_"+c)){d.data(this,"plugin_"+c,new f(this,j))}})}return this}}(jQuery,window,document));
/*!
 * jQuery imagesLoaded plugin v2.1.2
 * http://github.com/desandro/imagesloaded
 *
 * MIT License. by Paul Irish et al.
 */
;(function(a,b){var c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.fn.imagesLoaded=function(l){var i=this,n=a.isFunction(a.Deferred)?a.Deferred():0,m=a.isFunction(n.notify),f=i.find("img").add(i.filter("img")),g=[],k=[],h=[];if(a.isPlainObject(l)){a.each(l,function(o,p){if(o==="callback"){l=p}else{if(n){n[o](p)}}})}function j(){var o=a(k),p=a(h);if(n){if(h.length){n.reject(f,o,p)}else{n.resolve(f)}}if(a.isFunction(l)){l.call(i,f,o,p)}}function e(o){d(o.target,o.type==="error")}function d(o,p){if(o.src===c||a.inArray(o,g)!==-1){return}g.push(o);if(p){h.push(o)}else{k.push(o)}a.data(o,"imagesLoaded",{isBroken:p,src:o.src});if(m){n.notifyWith(a(o),[p,f,a(k),a(h)])}if(f.length===g.length){setTimeout(j);f.unbind(".imagesLoaded",e)}}if(!f.length){j()}else{f.bind("load.imagesLoaded error.imagesLoaded",e).each(function(o,q){var r=q.src,p=a.data(q,"imagesLoaded");if(p&&p.src===r){d(q,p.isBroken);return}if(q.complete&&q.naturalWidth!==b){d(q,q.naturalWidth===0||q.naturalHeight===0);return}if(q.readyState||q.complete){q.src=c;q.src=r}})}return n?n.promise(i):i}})(jQuery);